<!DOCTYPE html>
<html class="no-js" lang="en">

<title>QuickBuy</title>
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="">
<meta property="og:type" content="">
<meta property="og:url" content="">
<meta property="og:image" content="">
<!-- Favicon -->
<link rel="shortcut icon" type="image/x-icon" href="assets/imgs/theme/favicon.svg">
<!-- Template CSS -->
<link rel="stylesheet" href="assets/css/main.css?v=3.4">
</head>

<body>
    <header class="header-area header-style-1 header-height-2">
        <div class="header-top header-top-ptb-1 d-none d-lg-block">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-xl-3 col-lg-4">
                        <div class="header-info">
                            <ul>
                                <li><i class="fi-rs-smartphone"></i> <a href="#">(+852)1234-5678</a></li>
                                <li><i class="fi-rs-marker"></i><a href="page-contact.html">Our location</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-xl-6 col-lg-4">
                        <div class="text-center">
                            <div id="news-flash" class="d-inline-block">
                                <ul>
                                    <li>Exclusive International Brands - Up to 60% Off </li>
                                    <li>Seize the Trends - Global Fashion at Your Fingertips</li>
                                    <li>Authentic Beauty Must-Haves - Shop Overseas Products </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-4">
                        <div class="header-info header-info-right">
                            <ul>
                                <li>
                                    <a class="language-dropdown-active" href="#"> <i class="fi-rs-world"></i> English <i
                                            class="fi-rs-angle-small-down"></i></a>
                                    <ul class="language-dropdown">
                                        <li><a href="#"><img src="assets/imgs/theme/flag-fr.png" alt="">Français</a>
                                        </li>
                                        <li><a href="#"><img src="assets/imgs/theme/flag-dt.png" alt="">Deutsch</a></li>
                                        <li><a href="#"><img src="assets/imgs/theme/flag-ru.png" alt="">Pусский</a></li>
                                    </ul>
                                </li>
                                <li id="loginLink"><i class="fi-rs-user"></i><a href="page-login-register.html">Log In /
                                        Sign Up</a></li>
                                <li id="logoutLink" style="display: none;"><i class="fi-rs-user"></i><a
                                        href="php/logout.php">Log Out</a></li>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="header-middle header-middle-ptb-1 d-none d-lg-block">
            <div class="container">
                <div class="header-wrap">
                    <div class="logo logo-width-1">
                        <a href="index.html"><img src="assets/imgs/theme/logo.svg" alt="logo"></a>
                    </div>
                    <div class="header-right">
                        <div class="search-style-2">
                            <form action="#">
                                <input type="text" placeholder="Search for items...">
                            </form>
                        </div>
                        <div class="header-action-right">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="header-bottom header-bottom-bg-color sticky-bar">
            <div class="container">
                <div class="header-wrap header-space-between position-relative">
                    <div class="logo logo-width-1 d-block d-lg-none">
                        <a href="index.html"><img src="assets/imgs/theme/logo.svg" alt="logo"></a>
                    </div>
                    <div class="header-nav d-none d-lg-flex">
                        <div class="main-categori-wrap d-none d-lg-block">
                            <a class="categori-button-active" href="#">
                                <span class="fi-rs-apps"></span> Browse Categories
                            </a>
                        </div>
                        <div class="main-menu main-menu-padding-1 main-menu-lh-2 d-none d-lg-block">
                            <nav>
                                <ul>
                                    <li><a class="active" href="index.html">Home </a>
                                    </li>
                                    <li>
                                        <a href="page-about.html">About</a>
                                    </li>
                                    <li><a href="shop-grid-right.html">Shop</a>
                                    </li>
                                    <li class="position-static"><a href="#">Mega menu</a>
                                    </li>
                                    <li><a href="blog-category-grid.html">Blog</a>
                                    </li>
                                    <li>
                                        <a href="page-contact.html">Contact</a>
                                    </li>
                                    <li><a href="#"></a>
                                    </li>
                                    <li><a href="#"></a>
                                    </li>
                                    <li><a href="#"></a>
                                    </li>
                                    <li><a href="#"></a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                    <div class="hotline d-none d-lg-block">
                        <p><i class="fi-rs-headset"></i><span>Hotline</span> 1234-5678 </p>
                    </div>
                    </p>
                    <div class="header-action-right d-block d-lg-none">
                        <div class="header-action-2">
                            <div class="header-action-icon-2 d-block d-lg-none">
                                <div class="burger-icon burger-icon-white">
                                    <span class="burger-icon-top"></span>
                                    <span class="burger-icon-mid"></span>
                                    <span class="burger-icon-bottom"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <main class="main">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="index.html" rel="nofollow">Home</a>
                    <span></span> Your Cart
                </div>
            </div>
        </div>
        <section class="mt-50 mb-50">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="table-responsive">
                            <table class="table shopping-summery text-center clean" id="cart-table">
                                <thead>
                                    <tr class="main-heading">
                                        <th scope="col">name</th>
                                        <th scope="col">description</th>
                                        <th scope="col">Price</th>
                                        <th scope="col">Quantity</th>
                                        <th scope="col">Subtotal</th>
                                        <th scope="col">Remove</th>
                                    </tr>
                                </thead>
                                <tbody>

                                </tbody>
                            </table>
                        </div>
                        <div class="cart-action text-end">

                            <a class="btn " href="index.html"><i class="fi-rs-shopping-bag mr-10"></i>Continue
                                Shopping</a>
                        </div>
                        <div class="divider center_icon mt-50 mb-50"><i class="fi-rs-fingerprint"></i></div>
                        <div class="row mb-50">
                            
                            <div class="col-lg-6 col-md-12">
                                <div class="border p-md-4 p-30 border-radius cart-totals">
                                    <div class="heading_s1 mb-3">
                                        <h4>Cart Totals</h4>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table">
                                            <tbody>
                                                <tr>
                                                    <td class="cart_total_label">Cart Subtotal</td>
                                                    <td class="cart_total_amount"><span
                                                            class="font-lg fw-900 text-brand">$240.00</span></td>
                                                </tr>
                                                <tr>
                                                    <td class="cart_total_label">Shipping</td>
                                                    <td class="cart_total_amount"> <i class="ti-gift mr-5"></i> Free
                                                        Shipping</td>
                                                </tr>
                                                <tr>
                                                    <td class="cart_total_label">Total</td>
                                                    <td class="cart_total_amount"><strong><span
                                                                class="font-xl fw-900 text-brand">$240.00</span></strong>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <a href="shop-checkout.html" class="btn "> <i class="fi-rs-box-alt mr-10"></i> Proceed To
                                        CheckOut</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <footer class="main">
        <section class="newsletter p-30 text-white wow fadeIn animated">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-7 mb-md-3 mb-lg-0">
                        <div class="row align-items-center">
                            <div class="col flex-horizontal-center">

                            </div>
                            <div class="col my-4 my-md-0 des">

                            </div>
                        </div>
                    </div>
                    <div class="col-lg-5">
                    </div>
                </div>
            </div>
        </section>
        <section class="section-padding footer-mid">
            <div class="container pt-15 pb-20">
                <div class="row">
                    <div class="col-lg-4 col-md-6">
                        <div class="widget-about font-md mb-md-5 mb-lg-0">
                            <div class="logo logo-width-1 wow fadeIn animated">
                                <a href="index.html"><img src="assets/imgs/theme/logo.svg" alt="logo"></a>
                            </div>
                            <h5 class="mt-20 mb-10 fw-600 text-grey-4 wow fadeIn animated">Contact</h5>
                            <p class="wow fadeIn animated">
                                <strong>Address: </strong>21 Yuen Wo Road, Sha Tin Wai, Sha Tin District, Hong Kong
                            </p>
                            <p class="wow fadeIn animated">
                                <strong>Phone: </strong>(+852) 1234-5678
                            </p>
                            <p class="wow fadeIn animated">
                                <strong>Hours: </strong>10:00 - 18:00, Mon - Sat
                            </p>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-3">
                        <h5 class="widget-title wow fadeIn animated">About</h5>
                        <ul class="footer-list wow fadeIn animated mb-sm-5 mb-md-0">
                            <li><a href="page-about.html">About Us</a></li>
                            <li><a href="page-privacy-policy.html">Privacy Policy</a></li>
                            <li><a href="page-contact.html">Contact Us</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-2  col-md-3">
                        <h5 class="widget-title wow fadeIn animated">My Account</h5>
                        <ul class="footer-list wow fadeIn animated">
                            <li><a href="page-login-register.html">Sign In</a></li>
                            <li><a href="shop-cart.html">View Cart</a></li>
                            <li><a href="shop-checkout.html">Check Out</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
        <div class="container pb-20 wow fadeIn animated">
            <div class="row">
                <div class="col-12 mb-20">
                    <div class="footer-bottom"></div>
                </div>
                <div class="col-lg-6">
                    <p class="float-md-left font-sm text-muted mb-0">&copy; 2024, <strong
                            class="text-brand">QuickBuy</strong> - Your Fast-Track to Quality Shopping
                    </p>
                </div>
                <div class="col-lg-6">
                    <p class="text-lg-end text-start font-sm text-muted mb-0">
                    </p>
                </div>
            </div>
        </div>
    </footer>
    <!-- Preloader Start -->
    <div id="preloader-active">
        <div class="preloader d-flex align-items-center justify-content-center">
            <div class="preloader-inner position-relative">
                <div class="text-center">
                    <h5 class="mb-5">Now Loading</h5>
                    <div class="loader">
                        <div class="bar bar1"></div>
                        <div class="bar bar2"></div>
                        <div class="bar bar3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Vendor JS-->
    <script src="assets/js/vendor/modernizr-3.6.0.min.js"></script>
    <script src="assets/js/vendor/jquery-3.6.0.min.js"></script>
    <script src="assets/js/vendor/jquery-migrate-3.3.0.min.js"></script>
    <script src="assets/js/vendor/bootstrap.bundle.min.js"></script>
    <script src="assets/js/plugins/slick.js"></script>
    <script src="assets/js/plugins/jquery.syotimer.min.js"></script>
    <script src="assets/js/plugins/wow.js"></script>
    <script src="assets/js/plugins/jquery-ui.js"></script>
    <script src="assets/js/plugins/perfect-scrollbar.js"></script>
    <script src="assets/js/plugins/magnific-popup.js"></script>
    <script src="assets/js/plugins/select2.min.js"></script>
    <script src="assets/js/plugins/waypoints.js"></script>
    <script src="assets/js/plugins/counterup.js"></script>
    <script src="assets/js/plugins/jquery.countdown.min.js"></script>
    <script src="assets/js/plugins/images-loaded.js"></script>
    <script src="assets/js/plugins/isotope.js"></script>
    <script src="assets/js/plugins/scrollup.js"></script>
    <script src="assets/js/plugins/jquery.vticker-min.js"></script>
    <!-- Template  JS -->
    <script src="./assets/js/main.js?v=3.4"></script>
    <script src="./assets/js/shop.js?v=3.4"></script>


    <script>
        // 页面加载完成后执行的函数
        document.addEventListener('DOMContentLoaded', function () {
            fetchCartData();
            isLoggedIn();
        });


        // 发起Ajax请求获取购物车数据
        function fetchCartData() {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'php/get-data.php', true);
            xhr.onload = function () {
                if (xhr.status >= 200 && xhr.status < 300) {
                    var cartItems = JSON.parse(xhr.responseText);
                    updateCart(cartItems);
                }
            };
            xhr.send();
        }

        // 使用获取的数据更新购物车
        function updateCart(cartItems) {
            var cartList = document.querySelector('#cart-table tbody');
            var total = 0;

            cartList.innerHTML = '';

            cartItems.forEach(function (item) {
                var subtotal = item.price * item.quantity;
                total += subtotal;

                var row = document.createElement('tr');
                row.innerHTML = `
                    <td class="product-name">${item.name}</td>
                    <td class="product-description">${item.description}</td>
                    <td class="price" data-title="Price"><span>$${item.price.toFixed(2)}</span></td>
                    <td class="quantity" data-title="Quantity">
                        <div class="detail-qty border radius m-auto">
                            <a href="#" class="qty-down"><i class="fi-rs-angle-small-down"></i></a>
                            <span class="qty-val" data-product-id="${item.product_id}">${item.quantity}</span>
                            <a href="#" class="qty-up"><i class="fi-rs-angle-small-up"></i></a>
                        </div>
                    </td>
                    <td class="subtotal" data-title="Subtotal"><span>$${subtotal.toFixed(2)}</span></td>
                    <td class="action" data-title="Remove"><a href="#" class="text-muted"><i class="fi-rs-trash"></i></a></td>
                `;
                cartList.appendChild(row);
            });

            document.querySelector('.cart_total_amount .font-lg').textContent = `$${total.toFixed(2)}`;
            document.querySelector('.cart_total_amount strong .font-xl').textContent = `$${total.toFixed(2)}`;
        }

        // 使用事件委托监听购物车操作
        document.querySelector('#cart-table').addEventListener('click', function (e) {
            // 防止链接的默认行为
            e.preventDefault();

            // 获取最近的 tr 父元素
            const row = e.target.closest('tr');

            // 根据 tr 元素获取需要更新的 .subtotal span
            const subtotalSpan = row.querySelector('.subtotal span');

            // 获取产品ID和数量
            const qtyVal = row.querySelector('.qty-val');
            const productId = parseInt(qtyVal.dataset.productId);
            let newQuantity;

            // 根据点击的是哪个按钮，来增加或减少数量
            if (e.target.closest('.qty-up')) {
                newQuantity = parseInt(qtyVal.textContent) + 1;
            } else if (e.target.closest('.qty-down')) {
                newQuantity = Math.max(1, parseInt(qtyVal.textContent) - 1);
            } else if (e.target.closest('.fi-rs-trash')) {
                // 如果点击的是删除按钮，执行删除操作
                removeProduct(productId, row);
                return; // 删除操作后无需进一步更新数量
            } else {
                // 如果点击的不是增加、减少或删除按钮，则不执行任何操作
                return;
            }

            // 获取单价
            const price = parseFloat(row.querySelector('.price span').textContent.replace('$', ''));

            // 更新数量
            updateQuantity(productId, newQuantity, subtotalSpan, price);
        });


        function updateQuantity(productId, newQuantity, subtotalSpan, price) {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', 'php/update-quantity.php', true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.onload = function () {
                if (xhr.status >= 200 && xhr.status < 300) {
                    console.log('Quantity updated:', xhr.responseText);
                    subtotalSpan.textContent = `$${(price * newQuantity).toFixed(2)}`;
                    fetchCartData();  // Refresh cart data to reflect changes
                } else {
                    console.error('Server responded with status:', xhr.status);
                }
            };
            xhr.onerror = function () {
                console.error('Network error occurred');
            };
            xhr.send(`product_id=${productId}&quantity=${newQuantity}`);
        }

        function removeProduct(productId, row) {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', 'php/remove-product.php', true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.onload = function () {
                if (xhr.status >= 200 && xhr.status < 300) {
                    console.log('Product removed:', xhr.responseText);
                    row.remove();  // Remove row from table
                    fetchCartData();  // Refresh cart data to reflect removal
                } else {
                    console.error('Server responded with status:', xhr.status);
                }
            };
            xhr.onerror = function () {
                console.error('Network error occurred');
            };
            xhr.send(`product_id=${productId}`);
        }

        // 检查用户是否已登录并更新UI的函数
        function isLoggedIn() {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'php/check-login.php', true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    var result = JSON.parse(xhr.responseText);
                    if (result.loggedIn) {
                        document.getElementById('logoutLink').style.display = 'block';
                        document.getElementById('loginLink').style.display = 'none';
                    } else {
                        // 用户未登录，重定向到登录页面
                        window.location.href = 'page-login-register.html';
                    }
                }
            };
            xhr.send();
        }
    </script>


</body>

</html>